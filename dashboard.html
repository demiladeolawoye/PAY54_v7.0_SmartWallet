<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PAY54 • Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="assets/css/theme.css" />

  <style>
    .dash-wrap {
      max-width: 1100px;
      margin: 40px auto;
      padding: 0 16px 40px;
    }
    .dash-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .dash-header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.25);
      font-size: 12px;
      opacity: 0.9;
    }
    .balance-card, .panel {
      background: rgba(255,255,255,0.04);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 18px;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .balance-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .balance-amount {
      font-size: 32px;
      font-weight: 700;
    }
    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .btn-secondary {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.3);
      background: transparent;
      color: inherit;
      cursor: pointer;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
    }
    .tile {
      padding: 14px 16px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.02);
      cursor: pointer;
    }
    .tile-title { font-weight: 600; margin-bottom: 4px; }
    .tile-sub   { font-size: 12px; opacity: 0.8; }

    .two-col {
      display: grid;
      grid-template-columns: 2fr 1.4fr;
      gap: 18px;
    }
    @media (max-width: 800px) {
      .two-col { grid-template-columns: 1fr; }
    }

    .panel-title { font-weight: 600; margin-bottom: 10px; }

    .list-item {
      font-size: 14px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    /* Simple modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal-backdrop.show { display: flex; }
    .modal-card {
      background: #050816;
      padding: 20px;
      border-radius: 16px;
      max-width: 360px;
      width: 100%;
      border: 1px solid rgba(255,255,255,0.15);
    }
    .modal-card h3 { margin-top: 0; }
    .modal-card label {
      display: block;
      font-size: 13px;
      margin-top: 8px;
      margin-bottom: 4px;
    }
    .modal-card input, .modal-card select {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: none;
      margin-bottom: 8px;
    }
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
    }
    .btn-ghost {
      border-radius: 8px;
      padding: 8px 12px;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.3);
      color: inherit;
      cursor: pointer;
    }
    .btn-primary {
      border-radius: 8px;
      padding: 8px 12px;
      background: #3b6cff;
      border: none;
      color: #fff;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="dash-wrap">
    <div class="dash-header">
      <div class="dash-header-left">
        <img src="assets/img/logo/pay54-logo.svg" alt="PAY54" style="height:40px;" />
        <div>
          <div style="font-weight:600;">PAY54 Wallet</div>
          <div style="font-size:13px;opacity:0.8;">Hybrid Money • NG ⇄ Global</div>
        </div>
      </div>
      <div>
        <span class="badge" id="userTag">@tag</span>
        <button class="btn-secondary" id="logoutBtn">Logout</button>
      </div>
    </div>

    <div class="two-col">
      <!-- LEFT: Balance + Money Moves + Services -->
      <div>
        <div class="balance-card">
          <div class="balance-top">
            <div>
              <div style="font-size:13px;opacity:0.8;">Total balance</div>
              <div class="balance-amount" id="walletBalance">₦0.00</div>
            </div>
            <div style="text-align:right;font-size:13px;">
              <div id="walletName">Demo wallet</div>
              <div id="walletId" style="opacity:0.8;">P54-000</div>
            </div>
          </div>

          <div class="btn-row">
            <button class="btn-secondary" data-action="add">Add money</button>
            <button class="btn-secondary" data-action="withdraw">Withdraw</button>
            <button class="btn-secondary" data-action="send">Send PAY54 → PAY54</button>
            <button class="btn-secondary" data-action="bank">Bank transfer</button>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Money moves</div>
          <div class="grid-2">
            <div class="tile" data-action="send">
              <div class="tile-title">Send PAY54 → PAY54</div>
              <div class="tile-sub">Instant P2P transfers</div>
            </div>
            <div class="tile" data-action="receive">
              <div class="tile-title">Receive</div>
              <div class="tile-sub">Show account, tag &amp; QR</div>
            </div>
            <div class="tile" data-action="add">
              <div class="tile-title">Add money</div>
              <div class="tile-sub">Card • Bank • Agents</div>
            </div>
            <div class="tile" data-action="withdraw">
              <div class="tile-title">Withdraw</div>
              <div class="tile-sub">Bank • Agents</div>
            </div>
            <div class="tile" data-action="bank">
              <div class="tile-title">Bank transfer</div>
              <div class="tile-sub">To NG banks &amp; wallets</div>
            </div>
            <div class="tile" data-action="request">
              <div class="tile-title">Request money</div>
              <div class="tile-sub">With notification list</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Services</div>
          <div class="grid-2">
            <div class="tile" data-action="fx">Cross-border FX</div>
            <div class="tile" data-action="savings">Savings</div>
            <div class="tile" data-action="bills">Pay bills (Airtime/Data/Power/TV)</div>
            <div class="tile" data-action="cards">Virtual &amp; linked cards</div>
            <div class="tile" data-action="checkout">PAY54 Smart Checkout</div>
            <div class="tile" data-action="shop">Shop on the Fly</div>
            <div class="tile" data-action="invest">Investments &amp; stocks</div>
            <div class="tile" data-action="bet">Bet funding</div>
            <div class="tile" data-action="risk">AI Risk Watch</div>
            <div class="tile" data-action="agent">Become an Agent</div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Requests, Shortcuts, Recent -->
      <div>
        <div class="panel">
          <div class="panel-title">Requests &amp; alerts</div>
          <div id="requestsList">
            <div class="list-item">No pending requests.</div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Quick shortcuts</div>
          <div class="btn-row">
            <button class="btn-secondary" data-action="agent">Become an Agent</button>
            <button class="btn-secondary" data-action="shop">Shop on the Fly</button>
            <button class="btn-secondary" data-action="savings">Open Savings Pot</button>
            <button class="btn-secondary" data-action="invest">Invest &amp; Stocks</button>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">Recent transactions</div>
          <div id="txList">
            <div class="list-item">Wallet created • ₦88,000.00</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Simple modal -->
  <div class="modal-backdrop" id="modal">
    <div class="modal-card">
      <h3 id="modalTitle">Action</h3>
      <div id="modalBody"></div>
      <div class="modal-actions">
        <button class="btn-ghost" id="modalCancel">Cancel</button>
        <button class="btn-primary" id="modalConfirm">Confirm</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { getUser, saveUser, logout } from "./assets/js/core/session.js";

    const user = getUser();
    if (!user) {
      window.location.href = "login.html";
    }

    // --- Populate header + balance
    const balanceEl = document.getElementById("walletBalance");
    const tagEl = document.getElementById("userTag");
    const walletNameEl = document.getElementById("walletName");
    const walletIdEl = document.getElementById("walletId");
    const txListEl = document.getElementById("txList");

    function formatNaira(amount) {
      return "₦" + amount.toLocaleString("en-NG", { minimumFractionDigits: 2 });
    }

    function renderUser() {
      const u = getUser();
      balanceEl.textContent = formatNaira(u.balance ?? 0);
      tagEl.textContent = u.tag || "@pay54demo";
      walletNameEl.textContent = (u.name || "PAY54 demo wallet");
      walletIdEl.textContent = u.walletId || "P54-001";
    }

    renderUser();

    // --- Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      logout();
    });

    // --- Modal helpers
    const modal = document.getElementById("modal");
    const modalTitle = document.getElementById("modalTitle");
    const modalBody = document.getElementById("modalBody");
    const modalCancel = document.getElementById("modalCancel");
    const modalConfirm = document.getElementById("modalConfirm");

    function openModal(title, innerHtml, onConfirm) {
      modalTitle.textContent = title;
      modalBody.innerHTML = innerHtml;
      modal.classList.add("show");
      const handler = () => {
        onConfirm && onConfirm();
        closeModal();
        modalConfirm.removeEventListener("click", handler);
      };
      modalConfirm.addEventListener("click", handler);
    }

    function closeModal() {
      modal.classList.remove("show");
    }

    modalCancel.addEventListener("click", closeModal);
    modal.addEventListener("click", (e) => {
      if (e.target === modal) closeModal();
    });

    // --- Action handlers (demo behaviour)
    function addTx(text) {
      const div = document.createElement("div");
      div.className = "list-item";
      div.textContent = text;
      txListEl.prepend(div);
    }

    function handleAction(action) {
      const u = getUser();
      switch (action) {
        case "add":
          openModal(
            "Add money",
            `<label>Amount (NGN)</label>
             <input id="amountInput" type="number" min="1" />`,
            () => {
              const amt = Number(document.getElementById("amountInput").value);
              if (!amt || amt <= 0) return;
              const updated = { ...u, balance: (u.balance || 0) + amt };
              saveUser(updated);
              renderUser();
              addTx(`Wallet top-up • +${formatNaira(amt)}`);
            }
          );
          break;

        case "withdraw":
          openModal(
            "Withdraw to bank",
            `<label>Amount (NGN)</label>
             <input id="amountInput" type="number" min="1" />`,
            () => {
              const amt = Number(document.getElementById("amountInput").value);
              if (!amt || amt <= 0 || amt > (u.balance || 0)) return;
              const updated = { ...u, balance: (u.balance || 0) - amt };
              saveUser(updated);
              renderUser();
              addTx(`Withdrawal • -${formatNaira(amt)}`);
            }
          );
          break;

        case "send":
          openModal(
            "Send PAY54 → PAY54",
            `<label>Recipient tag</label>
             <input id="recTag" placeholder="@friend" />
             <label>Amount (NGN)</label>
             <input id="amountInput" type="number" min="1" />`,
            () => {
              const amt = Number(document.getElementById("amountInput").value);
              if (!amt || amt <= 0 || amt > (u.balance || 0)) return;
              const updated = { ...u, balance: (u.balance || 0) - amt };
              saveUser(updated);
              renderUser();
              addTx(`Sent ${formatNaira(amt)} to PAY54 friend`);
            }
          );
          break;

        case "bank":
          openModal(
            "Bank transfer",
            `<label>Bank</label>
             <input placeholder="Bank name" />
             <label>Account number</label>
             <input maxlength="10" />
             <label>Amount (NGN)</label>
             <input id="amountInput" type="number" min="1" />`,
            () => {
              const amt = Number(document.getElementById("amountInput").value);
              if (!amt || amt <= 0 || amt > (u.balance || 0)) return;
              const updated = { ...u, balance: (u.balance || 0) - amt };
              saveUser(updated);
              renderUser();
              addTx(`Bank transfer • -${formatNaira(amt)}`);
            }
          );
          break;

        case "receive":
          openModal(
            "Receive money",
            `<p>Share your PAY54 tag and wallet ID:</p>
             <p><strong>Tag:</strong> ${u.tag || "@pay54demo"}</p>
             <p><strong>Wallet ID:</strong> ${u.walletId || "P54-001"}</p>`,
            () => {}
          );
          break;

        default:
          openModal(
            "Coming soon",
            `<p>This is a demo preview for <strong>${action}</strong> in PAY54 v7.0.</p>`,
            () => {}
          );
      }
    }

    document.querySelectorAll("[data-action]").forEach((el) => {
      el.addEventListener("click", () => {
        const action = el.getAttribute("data-action");
        handleAction(action);
      });
    });
  </script>
</body>
</html>
